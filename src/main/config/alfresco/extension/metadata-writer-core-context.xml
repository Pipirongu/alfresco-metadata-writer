<?xml version='1.0' encoding='UTF-8'?>

<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

  <bean id="metadata-writer.dictionaryBootstrap" parent="dictionaryModelBootstrap" depends-on="dictionaryBootstrap">
    <property name="models">
      <list>
        <value>alfresco/extension/model/metadataWriterModel.xml</value>
      </list>
    </property>
  </bean>

  <bean id="metadata-writer.configBootstrap" class="org.alfresco.web.config.WebClientConfigBootstrap" init-method="init">
    <property name="configs">
      <list>
        <value>alfresco/extension/metadata-writer-web-client-config.xml</value>
      </list>
    </property>
  </bean>

  <!-- The Metadata service registry -->
  <bean id="metadata-writer.serviceRegistry" class="org.redpill.alfresco.module.metadatawriter.factories.impl.MetadataServiceRegistryImpl" />

  <!-- Factory amd instantiators for content types -->
  <bean id="metadata-writer.MSWordInstantiator" class="org.redpill.alfresco.module.metadatawriter.services.impl.POIFSContentInstantiator$MSWordContentInstantiator" />

  <bean id="metadata-writer.MSExcelInstantiator" class="org.redpill.alfresco.module.metadatawriter.services.impl.POIFSContentInstantiator$MSExcelContentInstantiator" />

  <bean id="metadata-writer.MSPowerPointInstantiator" class="org.redpill.alfresco.module.metadatawriter.services.impl.POIFSContentInstantiator$MSPowerPointContentInstantiator" />

  <bean id="metadata-writer.MSWordInstantiatorX" class="org.redpill.alfresco.module.metadatawriter.services.impl.POIXContentInstantiator$MSWordContentInstantiator" />

  <bean id="metadata-writer.MSExcelInstantiatorX" class="org.redpill.alfresco.module.metadatawriter.services.impl.POIXContentInstantiator$MSExcelContentInstantiator" />

  <bean id="metadata-writer.MSPowerPointInstantiatorX" class="org.redpill.alfresco.module.metadatawriter.services.impl.POIXContentInstantiator$MSPowerPointContentInstantiator" />

  <bean id="metadata-writer.PdfInstantiator" class="org.redpill.alfresco.module.metadatawriter.services.impl.PdfContentInstantiator" />

  <bean id="metadata-writer.contentFactory" class="org.redpill.alfresco.module.metadatawriter.factories.impl.MetadataContentFactoryImpl">
    <constructor-arg type="org.alfresco.service.cmr.repository.ContentService">
      <ref bean="ContentService" />
    </constructor-arg>
    <constructor-arg type="java.util.Set">
      <set>
        <ref bean="metadata-writer.MSWordInstantiator" />
        <ref bean="metadata-writer.MSExcelInstantiator" />
        <ref bean="metadata-writer.MSPowerPointInstantiator" />
        <ref bean="metadata-writer.MSWordInstantiatorX" />
        <ref bean="metadata-writer.MSExcelInstantiatorX" />
        <ref bean="metadata-writer.MSPowerPointInstantiatorX" />
        <ref bean="metadata-writer.PdfInstantiator" />
      </set>
    </constructor-arg>
  </bean>

  <!-- The write metadata aspect -->
  <bean id="metadata-writer.writeMetadataAspect" class="org.redpill.alfresco.module.metadatawriter.aspect.impl.ExportMetadataAspect">
    <property name="metadataServiceRegistry" ref="metadata-writer.serviceRegistry" />
    <property name="nodeService" ref="NodeService" />
    <property name="policyComponent" ref="policyComponent" />
  </bean>

  <!-- Metadata service abstract bean -->
  <bean id="metadata-writer.abstract.service" class="org.redpill.alfresco.module.metadatawriter.services.impl.MetadataServiceImpl" init-method="register" abstract="true">
    <constructor-arg type="org.redpill.alfresco.module.metadatawriter.factories.MetadataServiceRegistry" ref="metadata-writer.serviceRegistry" />
    <constructor-arg type="org.redpill.alfresco.module.metadatawriter.factories.MetadataContentFactory" ref="metadata-writer.contentFactory" />
    <constructor-arg type="org.alfresco.service.namespace.NamespaceService" ref="NamespaceService" />
    <constructor-arg type="org.alfresco.service.transaction.TransactionService" ref="TransactionService" />
    <constructor-arg type="org.alfresco.repo.policy.BehaviourFilter" ref="policyBehaviourFilter" />
    <constructor-arg type="org.alfresco.service.cmr.repository.NodeService" ref="NodeService" />
    <property name="nodeMetadataProcessor" ref="metadata-writer.metadataProcessor" />
    <property name="nodeVerifierProcessor" ref="metadata-writer.verifierProcessor" />
    <property name="threadPoolExecutor" ref="metadata-writer.threadPoolExecutor" />
  </bean>

  <!-- Creates a thread pool executer with a very low priority. This is to assure that threads that takes a very long time will not interfere too much -->
  <bean id="metadata-writer.threadPoolExecutor" class="org.redpill.alfresco.module.metadatawriter.util.ThreadPoolExecutorFactoryBean">
    <property name="poolName" value="metadata-writer.ThreadPool" />
    <property name="corePoolSize" value="1" />
    <property name="maximumPoolSize" value="2" />
    <property name="threadPriority" value="1" />
    <property name="timeout" value="10" />
  </bean>

  <bean id="metadata-writer.metadataProcessor" class="org.redpill.alfresco.module.metadatawriter.services.impl.DefaultMetadataProcessor">
    <constructor-arg type="org.alfresco.service.cmr.repository.NodeService" ref="NodeService" />
  </bean>

  <bean id="metadata-writer.verifierProcessor" class="org.redpill.alfresco.module.metadatawriter.services.impl.DefaultVerifierProcessor">
    <constructor-arg type="org.alfresco.service.cmr.repository.NodeService" ref="NodeService" />
    <constructor-arg type="org.alfresco.service.cmr.lock.LockService" ref="LockService" />
    <constructor-arg type="org.alfresco.service.cmr.dictionary.DictionaryService" ref="DictionaryService" />
  </bean>

</beans>